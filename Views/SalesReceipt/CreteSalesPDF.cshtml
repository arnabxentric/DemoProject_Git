@model IEnumerable<XenERP.Models.CustomerwiseInvoice>
@using XenERP.Models
@{
  
    int Slno = 0;
    var custid = "";
}


<link href="../../Content/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<script src="../../Scripts/SalesInvoice.js" type="text/javascript"></script>
<script src="../../Scripts/PurchaseCostingDetail.js" type="text/javascript"></script>
<script src="../../js/jquery-ui-1.10.3.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../../css/datetimepicker/datepicker.css" />
<script src="../../js/plugins/datetimepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="../../Accordion/highlight.js" type="text/javascript"></script>
<link href="../../Accordion/github.css" rel="stylesheet" type="text/css" />
<link href="../../Accordion/Demo.css" rel="stylesheet" type="text/css" />
<script src="../../Accordion/Cookie.js" type="text/javascript"></script>
<script src="../../Accordion/accordion.js" type="text/javascript"></script>

<script language="javascript" type="text/javascript">


    $(document).ready(function () {

        $("#cash1").attr("checked", true);
        $("#cheque").show();
        $("#cash").hide();
        $("#payment").show();
        $("#credit").hide();


        $("#Cash1").on("click", function () {


            if ($(this).is(':checked')) {

                $("#cheque").show();

            }

            else {

                $("#cheque").hide();


            }

        });


        $("#Cash2").on("click", function () {



            if ($(this).is(':checked')) {

                $("#cash").show();

            }

            else {

                $("#cash").hide();


            }



        });

        $("#Cash3").on("click", function () {



            if ($(this).is(':checked')) {

                $("#credit").show();


            }

            else {

                $("#credit").hide();


            }



        });


        $('input[name="chk"]').on('click', function () {

            if ($('input[name="chk"]').is(':checked'))
                $("#payment").show(); // checked
            else
                $("#payment").hide();  // unchecked

        })




    });

</script>
<script type="text/javascript">
    $(document).ready(function () {

        $('#RPBankAmount').val('0.0');
        $('#RPCashAmount').val('0.0');
        $('#TotBalance').val('0.0');
        $('#Totalpayment').val('0.0');
        $('#cardamount').val('0.0');



        $('#RPBankAmount').keyup(function () {
            var chAmnt = $('#RPBankAmount').val();
            var caAmnt = $('#RPCashAmount').val();
            var cardAmt = $('#cardamount').val();


            if (chAmnt != '') {
                if (caAmnt != '0') {
                    var amnt = parseFloat(chAmnt) + parseFloat(caAmnt) + parseFloat(cardAmt);
                    $('#Totalpayment').val(amnt);
                }
                else {
                    var amnt = parseFloat(chAmnt);
                    $('#Totalpayment').val(amnt);
                }
            }


        });



        $('#RPCashAmount').keyup(function () {
            var chAmnt = $('#RPBankAmount').val();
            var caAmnt = $('#RPCashAmount').val();
            var cardAmt = $('#cardamount').val();

            if (caAmnt != '') {

                if (chAmnt != '0' || chAmnt != '') {
                    var amnt = parseFloat(chAmnt) + parseFloat(caAmnt) + parseFloat(cardAmt);
                    $('#Totalpayment').val(amnt);
                }
                else {
                    var amnt = parseFloat(chAmnt);
                    $('#Totalpayment').val(amnt)
                }
            }

        });

        $('#cardamount').keyup(function () {
            var chAmnt = $('#RPBankAmount').val();
            var caAmnt = $('#RPCashAmount').val();
            var cardAmt = $('#cardamount').val();

            if (caAmnt != '') {

                if (chAmnt != '0' || chAmnt != '') {
                    var amnt = parseFloat(chAmnt) + parseFloat(caAmnt) + parseFloat(cardAmt);
                    $('#Totalpayment').val(amnt);
                }
                else {
                    var amnt = parseFloat(chAmnt);
                    $('#Totalpayment').val(amnt)
                }
            }

        });



        $('#btnsave').on("click", function () {


            if ($("input:checkbox[id=Cash1]:checked").val() == "1") {

                if ($("#RPBankId").val() == "") {
                    alert("Please select a Bank");
                    return false;

                }

                if ($("#chequeNo").val() == "") {
                    alert("Please enter chequeNo.");
                    return false;

                }

                if ($("#RPBankAmount").val() == "") {
                    alert("Please enter cheque amount");
                    return false;

                }

                if ($("#chequeDate").val() == "") {
                    alert("Please enter cheque date");
                    return false;

                }
            }


            if ($("input:checkbox[id=Cash2]:checked").val() == "2") {

                if ($("#RPCashAmount").val() == "") {
                    alert("Please enter Cash amount");
                    return false;

                }


            }


        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {


        $("#GroupId").change(function () {

            $.get("/Product/GetParentgroup", { id: $("#GroupId").val() }, function (data) {


                if (data != null) {

                    $("#parentname").val(data);
                }

                if (data == null || data == "") {

                }

            });
        });

        $('#SalesPrice').keypress(function (event) {
            if (event.which == 8 || event.which == 37 || event.which == 38 || event.which == 39 || event.which == 0) {
                return true;
            }

            if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57) && event.which != 8) {

                event.preventDefault();
                return false;

            }
            if (($(this).val().indexOf('.') != -1) && ($(this).val().substring($(this).val().indexOf('.'), $(this).val().indexOf('.').length).length > 2)) {

                event.preventDefault();
            }
        });
        $('#btnProduct').click(function () {
            var Code = $('#Code').val();

            var SalesPrice = $('#SalesPrice').val();
            if (Code == '' || SalesPrice == '') {
                $('#errordiv1').html('');
                $('#errordiv1').css("display", "block");

                if (Code == '') {
                    $('#Code').parents(".form-group:first").addClass("has-error");
                    $('#errordiv1').append('Product Code cannot be blank <br/>');
                }
                else {
                    $('#Code').parents(".form-group:first").removeClass("has-error");
                }
                if (Description == '') {
                    $('#Description').parents(".form-group:first").addClass("has-error");
                    $('#errordiv1').append('Enter Product Name cannot be blank <br/>');
                }
                else {
                    $('#Code').parents(".form-group:first").removeClass("has-error");
                }
                if (SalesPrice == '') {
                    $('#SalesPrice').parents(".form-group:first").addClass("has-error");
                    $('#errordiv1').append('Enter Sales Price <br/>');
                }
                else {
                    $('#SalesPrice').parents(".form-group:first").removeClass("has-error");
                }
                return false;
            }
            else {
                $('#errordiv1').html('');
                $('#errordiv1').css("display", "none");
                var Description = $('#Description').val();
                var UnitId = $('#UnitId').val();
                var GroupId = $('#GroupId').val();
                Code = $('#parentname').val() + '-' + Code;

                $('#btnProduct').css("display", "none");
                $('#loader').css("display", "block");
                $.post('/Product/Create', { 'Code': Code, 'Description': Description, 'UnitId': UnitId, 'GroupId': GroupId, 'SalesPrice': SalesPrice }, function (data, status) {
                    if (data == "Duplicate") {
                        $('#errordiv1').html('');
                        $('#errordiv1').css("display", "block");
                        $('#errordiv1').append('Product with this code already exists <br/>');
                        $('#btnProduct').css("display", "block");
                        $('#loader').css("display", "none");
                        return false;
                    }
                    if (data != 'Failed') {
                        dropDownProduct += '<option value="' + data.Id + '">' + data.Code + '</option>';
                        alert(dropDownProduct);
                        var ctd = $('#drpProduct').closest('td'); //.attr('id');
                        var ctr = ctd.closest('tr');
                        // alert(ctd);
                        ctd.html('');
                        ctd.html(dropDownProduct);
                        ctd.find('#drpProduct').val(data.Id);

                        var qty = ctr.find('#quantity').val(1);
                        var up = ctr.find('#unitprice').val(data.SalesPrice);
                        var as = ctr.find('.availabilityhide').val(data.Availability);
                        var tx = ctr.find('#drpTax').val($('#TaxId').val());
                        ctr.find('.uom').val(data.UnitId);
                        ctr.find('.uomhide').val(data.UnitName);
                        var amount = parseFloat(qty.val()) * parseFloat(up.val());
                        var am = ctr.find('.amounthide').val(parseFloat(amount));

                        $('#myModal').modal('hide');
                        $('#Code').val('');
                        $('#Description').val('');
                        $('#UnitId').val('');
                        $('#GroupId').val('');

                        $('#SalesPrice').val('');

                        $('#btnProduct').css("display", "block");
                        $('#loader').css("display", "none");
                    }
                    else {
                        $('#errordiv1').html('');
                        $('#errordiv1').css("display", "block");
                        $('#errordiv1').append('Product create failed <br/>');
                        $('#btnProduct').css("display", "block");
                        $('#loader').css("display", "none");
                        return false;
                    }
                });
            }
        });

        $('#CustomerCode').change(function () {

            var CusId = $('#CustomerCode').val();



            if (CusId == null || CusId == '') {


                $('#CustomerName').val('');
                $('#City').val('');
                $('#Currencyrate').val('');
                $('#TransactionCurrencyCode').val('');
                $('#StateRegion').val('');
                $('#Country').val('');
                $('#BaseCurrencyCode').text('');
            }

            else {

                $.get('/SalesReceipt/getSelectedCustomer', { 'id': CusId }, function (data, status) {


                    $('#CustomerName').val(data.Name);
                    $('#City').val(data.City);
                    $('#Currencyrate').val(data.CurrencyPurchaseRate);
                    $('#TransactionCurrencyCode').val(data.CurrencyCode);
                    $('#StateRegion').val(data.State);
                    $('#Country').val(data.Country);

                    $('#BaseCurrencyCode').text(data.CurrencyCode);


                });
            }
        });





        if ('@ViewBag.Id' != '') {

            var dw = parseInt('@ViewBag.Id');

            $('#WarehouseId').val(dw);
            $('#DeliveryName').val('@ViewBag.AdressName');
            $('#StreetPoBox').val('@ViewBag.Address');
            $('#Suburb').val('@ViewBag.Suburb');
            $('#City').val('@ViewBag.Town');
            $('#StateRegion').val('@ViewBag.State');
            $('#Country').val('@ViewBag.Country');
            $('#PostalCode').val('@ViewBag.PIN');

        }




    });
</script>
<script type="text/javascript">

    $(document).ready(function () {

        $("#btnPayment").on("click", function (event) {
            window.location.href = 'PurchaseInvoice/Create';
            return false;
        });

        $("#btnDraft").on("click", function (event) {
            $("#Status").val("Saved As Draft");

        });

        $("#btnSave").on("click", function (event) {
            $("#Status").val("Saved");

        });



        $("form").on("submit", function (event) {

            var isValid = $(this).valid();

            if (isValid) {
                var result = checkproductcount();

                if (result == false) {
                    $('#errordiv').css("display", "block");
                    $('#errordiv').append('You must add atleast one line item');
                    return false;
                }
                //  event.preventDefault();

                $("#loading").fadeIn();
                var opts = {
                    lines: 12, // The number of lines to draw
                    length: 7, // The length of each line
                    width: 4, // The line thickness
                    radius: 10, // The radius of the inner circle
                    color: '#000', // #rgb or #rrggbb
                    speed: 2.0, // Rounds per second
                    trail: 60, // Afterglow percentage
                    shadow: false, // Whether to render a shadow
                    hwaccel: false // Whether to use hardware acceleration
                };
                var target = document.getElementById('loading');
                var spinner = new Spinner(opts).spin(target);
            }

            else {

                //                $("#btnsave").show();
            }


        });





        $("#dp3").datepicker({ autoclose: true, todayHighlight: true });
        $("#dp4").datepicker({ autoclose: true, todayHighlight: true });


    });
    



</script>
<script type="text/javascript">

    $(document).ready(function () {

        var SlNo = 0;

        var custid = '@ViewBag.id';
        
        $.get("/SalesReceipt/GetCustomerInvoice", { id: custid, amount: "0" }, function (dataitem) {

            var invamount = 0;
            var Invdue = 0;
            var Invpaid = 0;
            $("table#example1").find("tr:gt(0)").remove();


            $("table#example2").find("tr:gt(0)").remove();

            $.each(dataitem, function (index, item) {



                invamount = parseFloat(invamount) + parseFloat(item.InvAmount);
                Invdue = parseFloat(Invdue) + parseFloat(item.DueAmount);
                Invpaid = parseFloat(Invpaid) + parseFloat(item.PaidAmount);

                SlNo++;

                var dateString = item.Date.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var month = currentTime.getMonth() + 1;
                var day = currentTime.getDate();
                var year = currentTime.getFullYear();
                var date = day + "/" + month + "/" + year;





                var eachrow = "<tr>"
                    + "<td align='center'>" + SlNo + "</td>"

                  + "<td>" + date  + "</td>"
                 + "<td align='center'>" + item.InvoiceNo + "</td>"
                 + "<td align='right'>" + item.InvAmount + "</td>"
                 + "<td align='right'>" + item.DueAmount + "</td>"
                  + "<td align='right'>" + item.PaidAmount + "</td>"

                  + "</tr>";
                $('#example1 tbody').append(eachrow);




            });
            var eachrow2 = "<tr>"

                                 + "<td align='right'>" + "<b>Total Invoiced Amount:</b>" + invamount.toFixed(2) + "</td>"
                                 + "<td align='right'>" + "<b>Total Due Amount:</b>" + Invdue.toFixed(2) + "</td>"
                                  + "<td align='right'>" + "<b>Total Paid Amount:</b>" + Invpaid.toFixed(2) + "</td>"
                                  + "</tr>";
            $('#example2 tbody').append(eachrow2);


        });

    });
  

</script>


<link rel="stylesheet" type="text/css" href="../../css/datetimepicker/datepicker.css" />
<!-- Main content -->
<body>
    <!-- header logo: style can be found in header.less -->
    <header class="header">
        
            <!-- Header Navbar: style can be found in header.less -->
          
        </header>
    <div class="wrapper row-offcanvas row-offcanvas-left">
        <!-- Left side column. contains the logo and sidebar -->
        <!-- Right side column. Contains the navbar and content of the page -->
        <aside class="right-side">                
                <!-- Content Header (Page header) -->
                <section class="content-header" style="margin-top:20px;">
                   
        


                <!-- Main content -->
                <section class="content invoice">                    
                    <!-- title row -->




                    <div style="float:left; width:45%; margin:10px">
                        <!-- /.col -->
                       @foreach (Company comp in ViewBag.company)
                       {
                              
                         <div>
                           <strong> From</strong><br /><br />
                            <address>
                             
                                <strong>@comp.Name</strong><br/>
                               Address: <strong> @comp.Address </strong><br />
                                 Contact No:<strong> @comp.ContactNumber</strong> <br />
                                Zip Code: <strong>@comp.Zipcode </strong><br />

                            Company Type:  <strong>@comp.CompanyType </strong><br/>
                             VAT NO.: <strong> @comp.GST_VATNumber </strong><br/>
                                TAN NO.:   <strong>@comp.TANNO </strong><br/>
                                PAN No:  <strong> @comp.PANNO </strong><br />
                              

                            </address>
                        </div>
                       }

</div>


                    <!-- info row -->
                    <div style="float:right; width:45%;margin:10px">
                        <!-- /.col -->
                          @foreach (Customer cus in ViewBag.customer)
                          {
                              
                        <div class="col-sm-4 invoice-col">
                           <strong> To</strong><br /><br />
                            <address>
                             
                               <strong>@cus.Name</strong><br/>
                               Address: <strong> @cus.PoAddressName </strong><br />
                                  Contact No:<strong> @cus.ContactMobile</strong> <br />
                                      Zip Code:  <strong>@cus.PoPostalCode </strong><br/>
                                 City:<strong> @cus.PoCity</strong> <br />
                             State: <strong>@cus.PoStateRegion </strong><br />
                        
                             
                            </address>
                        </div>
                              
                          }
               
                    </div><!-- /.row -->
                   


                   


  




<div class="col-xs-12">
                <div class="box-report">
                    <div class="box-body no-padding">
                        <table id="example1" class="table table-bordered table-striped table-hover tablepdf" style="text-align:center">
                            <thead>
                                <tr>
                                    <th style="text-align:center">
                                        SlNo.
                                    </th>
                                    <th style="text-align:center">
                                        Invoice Date
                                    </th>
                                    <th style="text-align:center">
                                        Invoice No.
                                    </th>
                                    <th style="text-align:center">
                                        Invoiced Amount
                                    </th>
                                    <th style="text-align:center">
                                        Due Amount
                                    </th>
                                    <th style="text-align:center">
                                        Already Paid 
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <table class="table table-bordered table-striped table-hover tablepdf" id="example2" width="100%" style="text-align:center">
                            <thead>
                                <tr>
                                  @*  <th>
                                  
                                    </th>
                                    <th>
                                    </th>
                                    <th>
                                    </th>
                                    <th>
                                    </th>
                                    <th>
                                    </th>
                                    <th>
                                    </th>*@
                                </tr>
                            </thead>
                            <tbody style="overflow:hidden;">
                            </tbody>
                        </table>
                        <br />
                              <br />
                                    <br />
                                        


                        <div class="col-xs-6">
                      <p><b>Date:   @String.Format("{0:dd/MM/yyyy}", DateTime.Today)</b></p>  
                        <b>Goods Exchange time from 3 p.m to 5 p.m with letter(Mon-Fri).<br />
           For any suggestion and complain please call us or SMS 8017308670<br />
            Please pay by A/C payee cheque only.<br />
        All disputes are subject to Kolkata juridisction only.</b>
                        
                        </div>
                        <div class="col-xs-4 pull-right">
                        <b><p> For @ViewBag.companyName </p>
                        <p>Authorized Signatory</p></b>
                        </div>






                    </div>
                    <br />
                    <br />
                    <br />
                </div>
                <!-- /.box -->
            </div>

      
 
  
  </section><!-- /.content -->
           </aside>
        <!-- end panel -->
        <!-- panel -->
        <!-- end panel -->
        <!-- panel -->
        <!-- end panel -->
        <!-- panel -->
        <div class="container">
            <div class="content">
                <style type="text/css">
                    #left_nav
                    {
                        width: 250px;
                    }
                    #body
                    {
                        width: 70%;
                        float: left;
                        margin: 10px;
                    }
                    .accordion
                    {
                        margin: 0;
                        padding: 10px;
                        height: 33px;
                        border-top: #f0f0f0 1px solid;
                        background: #53a9bc;
                        font-family: Arial, Helvetica, sans-serif;
                        text-decoration: none;
                        text-transform: uppercase;
                        color: #000;
                        font-size: 1em;
                    }
                    .accordion-open
                    {
                        background: #000;
                        color: #fff;
                    }
                    .accordion-open span
                    {
                        display: block;
                        float: right;
                        padding: 10px;
                    }
                    .accordion-open span
                    {
                        background: url(/../Images/minus.png) center center no-repeat;
                    }
                    .accordion-close span
                    {
                        display: block;
                        float: right;
                        background: url(/../Images/plus.png) center center no-repeat;
                        padding: 10px;
                    }
                    div.container
                    {
                        padding: 0;
                        margin: 0;
                    }
                    div.content
                    {
                        background: #f0f0f0;
                        margin: 0;
                        padding: 10px;
                        font-size: .9em;
                        line-height: 1.5em;
                        font-family: "Helvetica Neue" , Arial, Helvetica, Geneva, sans-serif;
                    }
                    div.content ul, div.content p
                    {
                        padding: 0;
                        margin: 0;
                        padding: 3px;
                    }
                    div.content ul li
                    {
                        list-style-position: inside;
                        line-height: 25px;
                    }
                    div.content ul li a
                    {
                        color: #555555;
                    }
                    code
                    {
                        overflow: auto;
                    }
                </style>
            </div>
        </div>
        <!-- end panel -->
    </div>
    <script type="text/javascript">
        $(document).ready(function () {

            //syntax highlighter
            hljs.tabReplace = '    ';
            hljs.initHighlightingOnLoad();

            $.fn.slideFadeToggle = function (speed, easing, callback) {
                return this.animate({ opacity: 'toggle', height: 'toggle' }, speed, easing, callback);
            };

            //accordion
            $('.accordion').accordion({
                defaultOpen: 'section1',
                cookieName: 'accordion_nav',
                speed: 'slow',
                animateOpen: function (elem, opts) { //replace the standard slideUp with custom function
                    elem.next().stop(true, true).slideFadeToggle(opts.speed);
                },
                animateClose: function (elem, opts) { //replace the standard slideDown with custom function
                    elem.next().stop(true, true).slideFadeToggle(opts.speed);
                }
            });

        });
    </script>

<!-- Table row -->
<!-- /.row -->
<!-- /.row -->
<!-- this row will not appear when printing -->
<div class="row no-print">
    <div class="col-xs-12">
        <button class="btn btn-default" onclick="window.print();">
            <i class="fa fa-print"></i>Print</button>
        <button class="btn btn-success pull-right">
            <i class="fa fa-credit-card"></i>Submit Payment</button>
        <button class="btn btn-primary pull-right" style="margin-right: 5px;">
            <i class="fa fa-download"></i>Generate PDF</button>
    </div>
</div>
