@using XenERP.Models

@{
    Layout = "~/Views/Shared/_LayoutReport.cshtml";
    var SlNo = 0;
    decimal? tdebit = 0;
    decimal? tcredit = 0;
    decimal? topeningdr = 0;
    decimal? topeningcr = 0;
    decimal? tclosingdr = 0;
    decimal? tclosingcr = 0;
    decimal? total = 0;
}


<script src="../../Chart/highcharts.js" type="text/javascript"></script>
<script src="../../Chart/exporting.js" type="text/javascript"></script>
<link href="../../Content/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="../../Reports/css/datetimepicker/datepicker.css" />
<script src="../../Reports/Scripts/custom.js" type="text/javascript"></script>
<script src="../../Reports/js/plugins/datetimepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="../../Reports/js/jquery-ui-1.10.3.js" type="text/javascript"></script>
<script src="../../Reports/Scripts/jQuery.print.js" type="text/javascript"></script>
<link href="~/Content/select2/select2.min.css" rel="stylesheet" />
<script src="~/Content/select2/select2.full.min.js"></script>
<script>
    $(document).ready(function () {
        $(".select2").select2();

    });
</script>
<script type="text/javascript">

    jQuery(document).ready(function ($) {

        $('#print').click(function () {

            var fromdate = $("#FromDate").val();

            var todate = $("#ToDate").val();

            if ((fromdate != "") && (todate != "")) {
                if (fromdate == "") {
                    alert("From Date cannot be left blank");
                    return false;
                }

                if (todate == "") {
                    alert("To Date cannot be left blank");
                    return false;
                }


                if ((Date.parse(fromdate)) > (Date.parse(todate))) {
                    alert("From Date cannot be greater than To Date");
                    return false;
                }
                var LedgerId = $('#LedgerId').val();

                //$("#btnshow").hide();

                //$("#loader").show();
                //$.post("/FinancialReport/GroupExport", { GroupId: $("#GroupId").val(), from: fromdate, to: todate }, function (data) {
                //    $("#CustomerDetails").css("display", "block");
                //    $("#CustomerDetails").html(data);

                //    $("#btnshow").show();
                //    $("#loader").hide();


                //});
                window.location.href = "/FinancialReport/GroupBranchExport?GroupId=" + $("#GroupId").val() + "&LedgerId=" + LedgerId + "&from=" + fromdate + "&To=" + todate;
                e.preventDefault();

            }
        });
    });
</script>
<script language="javascript" type="text/javascript">

    $(document).ready(function () {
        $("#exportformat").hide();
        $('#remove').click(function () {
            $('#CustomerDetails').show();
        });
    });
</script>
<style type="text/css">
    .col-lg-12export {
        min-height: 1px;
        padding-left: 15px;
        padding-right: 15px;
        position: relative;
    }


    .ui-autocomplete-loading {
        background: white url("../../Images/ajax-loader(1).gif") right center no-repeat;
    }

    .ErrorControl {
        background: none repeat scroll 0 0 #fbe3e4;
        border: 1px solid Red;
        padding: 4px;
        width: 96%;
    }

    .pad {
        width: 100% !important;
    }
</style>
<script type="text/javascript">

    $(document).ready(function () {

        $("#loader").hide();
        // var Culture="@Session["DateCulture"]";
        $("#dp3").datepicker({ autoclose: true, todayHighlight: true });
        $("#dp4").datepicker({ autoclose: true, todayHighlight: true });
        $("#graph").show();

        $('#btnsubmit').click(function () {
            $("#exportformat").show();
            var fromdate = $("#FromDate").val();

            var todate = $("#ToDate").val();

            if ((fromdate != "") && (todate != "")) {
                if (fromdate == "") {
                    alert("From Date cannot be left blank");
                    return false;
                }

                if (todate == "") {
                    alert("To Date cannot be left blank");
                    return false;
                }


                if ((Date.parse(fromdate)) > (Date.parse(todate))) {
                    alert("From Date cannot be greater than To Date");
                    return false;
                }

                var LedgerId = $('#LedgerId').val();
                $("#btnshow").hide();

                $("#loader").show();
                $.post("/FinancialReport/GroupReport", { GroupId: $("#GroupId").val(), LedgerId: LedgerId, from: fromdate, to: todate }, function (data) {
                    $("#CustomerDetails").css("display", "block");
                    $("#CustomerDetails").html(data);

                    $("#btnshow").show();
                    $("#loader").hide();


                });

            }
        });

    });


</script>
<!---------------Export Format------------>
<script type="text/javascript">
    function onDataBound(e) {


        // Get the export link as jQuery object
        var $exportLink = $('#export');

        // Get its 'href' attribute - the URL where it would navigate to
        var href = $exportLink.attr('href');

        // Update the 'page' parameter with the grid's current page
        href = href.replace(/page=([^&]*)/, 'page=' + requestObject.page || '~');

        // Update the 'sort' parameter with the grid's current sort descriptor
        href = href.replace(/sort=([^&]*)/, 'sort=' + requestObject.sort || '~');

        // Update the 'pageSize' parameter with the grid's current pageSize
        href = href.replace(/pageSize=([^&]*)/, 'pageSize=' + grid.dataSource._pageSize);

        //update filter descriptor with the filters applied

        href = href.replace(/filter=([^&]*)/, 'filter=' + (requestObject.filter || '~'));

        // Update the 'href' attribute
        $exportLink.attr('href', href);
    }
</script>
<script type="text/javascript">

    function validationCheck() {

        var summary = "";



        summary += isvalidEmail();

        summary += isvalidSubject();



        if (summary != "") {

            alert(summary);

            return false;

        }

        else {

            return true;

        }

    }

    function isvalidEmail() {

        var id;

        var temp = document.getElementById("emailid");

        id = temp.value;

        var re = /\w+([-+.']\w+)*@@\w+([-.]\w+)*\.\w+([-.]\w+)*/;

        if (id == "") {

            return ("Please Enter Email" + "\n");

        }

        else if (re.test(id)) {

            return "";

        }



        else {

            return ("Email should be in the form abc@xyz.com" + "\n");

        }

    }

    function isvalidSubject() {

        var id;

        var temp = document.getElementById("subject");

        id = temp.value;

        if (id == "") {

            return ("Please enter Subject" + "\n");

        }

        else {

            return "";

        }

    }


</script>
<script type="text/javascript">

    $(document).ready(function (e) {
        $('#pdfPrint').click(function () {
            var fd = $('#FromDate').val();
            var ed = $('#ToDate').val();
            var GroupId = $('#GroupId').val();
            var LedgerId = $('#LedgerId').val();
            window.location.href = "/FinancialReport/GroupPDFlink?GroupId=" + GroupId + "&LedgerId=" + LedgerId + "&from=" + fd + "&To=" + ed;
            e.preventDefault();
        });

        $('#btnmail').click(function () {

            var id;

            var temp = document.getElementById("emailid");

            id = temp.value;


            if (id == "") {

                alert("Please Enter Email" + "\n");
                return false;

            }

            var sub;

            var temp = document.getElementById("subject");

            sub = temp.value;

            if (sub == "") {



                alert("Please Enter Subject" + "\n");
                return false;

            }

            else {



                var Mail = $("#emailid").val();
                var msg = $("#message").val();
                var sub = $("#subject").val();

                $.post("/SalesReport/SalesbyDateMail", { Mailto: Mail, message: msg, subj: sub }, function (data) {

                    window.location.href = "/SalesReport/SalesbyDate";

                });
            }

        });
    });


</script>
<script language="javascript" type="text/javascript">

    $(document).ready(function () {
        $('#LedgerDiv').hide();
        $('#txtGroup').autocomplete({


            source: function (request, response) {
                $.ajax({
                    url: '/GroupMaster/getGroupsByName',
                    data: { query: request.term },
                    dataType: 'json',
                    type: 'POST',
                    success: function (data) {
                        response($.map(data, function (item) {

                            return {
                                label: item.Name,
                                value: item.Id
                            }
                        }));
                    }
                })
            },
            select: function (event, ui) {

                $('#txtGroup').val(ui.item.label);
                $('#GroupId').val(ui.item.value);
                // alert(ui.item.value);
                if (ui.item.value == '108') {
                    $('#LedgerDiv').show();
                    $.get('/SalesReport/getSundryDebtors', {}, function (data, status) {
                        var $dropdown = $("#LedgerId");
                        $dropdown.append($("<option />").val('').text('All Sundry Debtors'));
                        $.each(data, function () {
                            $dropdown.append($("<option />").val(this.LedgerId).text(this.Name));
                        });
                    });
                }
                else {
                    $('#LedgerId')
                        .find('option')
                        .remove()
                        .end();
                    $('#LedgerDiv').hide();
                }

                return false;
            },
            minLength: 1
        });


    });


</script>
<script type="text/javascript">
    function printDiv(divID) {
        //Get the HTML of div
        var divElements = document.getElementById(divID).innerHTML;
        //Get the HTML of whole page
        var oldPage = document.body.innerHTML;

        //Reset the page's HTML with div's HTML only
        document.body.innerHTML =
            "<html><head><title></title></head><body>" +
            divElements + "</body>";

        //Print Page
        window.print();
        //Restore orignal HTML
        // document.body.innerHTML = oldPage;
    }
</script>
@*<script>
        $(document).ready(function () {
            var year = (new Date).getFullYear();
            var month = (new Date).getMonth() + 1;
            if (month >= 4) {
                Year = year;
            }
            else Year = year - 1;
            $('#FromDate').val(Year + "/" + 04 + "/" + 01);
            $('#ToDate').val((Year + 1) + "/" + 03 + "/" + 31);
        });
    </script>*@


<!-----------------End Format----------->


@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    <aside class="right-side">
        <section class="content-header">
            <h1>Group <small>Report</small></h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li><a href="#">Forms</a></li>
                <li class="active">General Elements</li>
            </ol>
        </section>



        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li class="pull-right"></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab_1">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="box box-primary">
                                        <div class="box-body">
                                            <table>
                                                <tr>
                                                    <td> &nbsp; &nbsp; &nbsp; &nbsp;Group :</td>
                                                    <td>

                                                        <input type="text" id="txtGroup" name="txtGroup" class="form-control" value="@(ViewBag.GroupName)" />


                                                        <input type="hidden" id="GroupId" name="GroupId" class="form-control" value="@(ViewBag.GroupId)" />
                                                    </td>

                                                    <td>
                                                        <span class="r-txt">&nbsp; &nbsp; &nbsp; &nbsp;From Date:</span>
                                                    </td>
                                                    <td>
                                                        <div class="input-group date" data-date-format="@Session["DateFormatLower"]" id="dp3">
                                                            <input type="text" readonly="readonly" class="form-control" id="FromDate" value="@(ViewBag.From)" />
                                                            <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                                        </div>
                                                    </td>

                                                    <td>
                                                        <span class="r-txt"> &nbsp; &nbsp; &nbsp; &nbsp;To Date:</span>
                                                    </td>

                                                    <td>
                                                        <div class="input-group date" data-date-format="@Session["DateFormatLower"]" id="dp4">
                                                            <input readonly="readonly" type="text" class="form-control" id="ToDate" value="@(ViewBag.To)" />
                                                            <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                                        </div>
                                                    </td>

                                                    <td>
                                                        <div>
                                                            <div id="loader"><img src="../../Images/ajax-loader(1).gif" /> </div>
                                                            <div id="btnshow">
                                                                &nbsp; &nbsp; &nbsp; &nbsp;<input type="button" id="btnsubmit" class="btn btn-primary" value="Show" />
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr><td colspan="8"></td></tr>
                                                <tr>
                                                    <td colspan="2">
                                                        <div id="LedgerDiv"> &nbsp; &nbsp; &nbsp; &nbsp;Sundry Debtors :  <select id="LedgerId" class="form-control select2"></select> </div>
                                                    </td>
                                                    <td colspan="6"></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="tab-pane" id="tab_4">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="box box-primary">
                                        <div class="box-header">
                                        </div>
                                        <div class="box-body">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </aside>
}
<div id="ProductDetailsprint">
</div>
<aside class="right-side">
    @*<div id="" class="box-body">
        <div class="box box-primary  table-responsive no-padding">
        <div class="box-header">
        <i class="fa fa-th"></i>
        <h3 class="box-title">Profit & Loss</h3>
        <div class="pull-right box-tools">

        <button class="btn btn-default btn-sm" data-widget='collapse' data-toggle="tooltip" title="Collapse">
        <i class="fa fa-minus"></i>
        </button>

        <button class="btn btn-default btn-sm" data-widget='remove' data-toggle="tooltip" title="Remove">
        <i class="fa fa-times"></i>
        </button>
        </div>
        </div>

        <div class='box-body pad'>
        <div id="Productgraph">
        </div>
        </div>
        </div>
        </div>*@

    <div class="input-group input-group-lg">
        <div class="col-lg-12" id="exportformat">
            <table>
                <tr>
                    <td>
                        <button data-toggle="dropdown" class="btn btn-primary" type="button">Exports <span class="fa fa-caret-down"></span></button>
                        <ul class="dropdown-menu">
                            <li><a id="pdfPrint" href="#"><img alt="img" src="../../Images/capture-pdf.png"></a></li>
                        </ul>
                    </td>
                    <td>   <button id="printd" class="btn btn-primary" type="button" onclick="javascript:printDiv('printdiv')"><i class="fa fa-print"></i>Print </button></td>
                    <td>   <button id="print" class="btn btn-primary" type="button"><i class="fa fa-print"></i>Excel </button></td>
                </tr>
            </table>




        </div><!-- /btn-group -->

    </div>
</aside>
<!-- COMPOSE MESSAGE MODAL -->
<div class="modal fade" id="compose-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-envelope-o"></i>Send a Report by Email
                </h4>
            </div>
            <form action="#" method="">
                <div class="modal-body">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">TO:</span>
                            <input name="email_to" type="email" id="emailid" class="form-control" placeholder="Email TO" />
                        </div>
                    </div>
                    <div id="cc" class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon">Subject:</span>
                            <input name="email_to" id="subject" type="email" class="form-control" value="Sales By Datewise Report"
                                   placeholder="Subject" />
                        </div>
                    </div>
                    <div class="form-group">
                        <textarea name="message" id="message" class="form-control" placeholder="Message"
                                  style="height: 120px;"></textarea>
                    </div>
                </div>
                <div class="modal-footer clearfix">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">
                        <i class="fa fa-times"></i>Discard
                    </button>
                    <button id="btnmail" type="button" class="btn btn-primary pull-left">
                        <i class="fa fa-envelope"></i>Send Message
                    </button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div id="CustomerDetails">
    @if (ViewBag.GroupResult != null)
    {


        <aside class="right-side">
            <div class="box box-primary">
                <div class="box-header"></div>
                <div class="box-body">
                    <div class="box-body table-responsive divContent">

                        <table id="example1" class="table table-bordered table-striped dataTable" aria-describedby="example1_info">
                            <thead>
                                <tr>
                                    <th colspan="8">

                                        <h3>@ViewBag.GroupName</h3>
                                    </th>
                                </tr>

                                <tr>
                                    <th rowspan="2" style="padding:10px;text-align:center;">SlNo.</th>

                                    <th rowspan="2" style="padding:10px;text-align:center;">
                                        Ledger Name
                                    </th>

                                    <th colspan="2">
                                        Opening Balance
                                    </th>

                                    <th colspan="2">
                                        Transactions
                                    </th>

                                    <th colspan="2">
                                        Closing Balance
                                    </th>



                                </tr>
                                <tr>
                                    @*<th>SlNo.</th>

                                        <th>
                                            @Html.DisplayNameFor(model => model.LedgerName)
                                        </th>*@

                                    <th>
                                        Debit Opening
                                    </th>
                                    <th>
                                        Credit Opening
                                    </th>
                                    <th>
                                        Debit
                                    </th>
                                    <th>
                                        Credit
                                    </th>
                                    <th>
                                        Debit Closing
                                    </th>
                                    <th>
                                        Credit Closing
                                    </th>


                                </tr>
                            </thead>
                            <tbody>
                                @foreach (AccountsBook_GroupWise_DateRange_Result item in ViewBag.GroupResult)
                                {
                                    SlNo = SlNo + 1;
                                    tdebit += item.Debit;
                                    tcredit += item.Credit;



                                    <tr>
                                        <td> @SlNo</td>

                                        <td>
                                            @*@item.LedgerName*@

                                            @Html.ActionLink(item.LedgerName, "BranchLedgerDetail", "FinancialReport", new { ledgerId = item.Lid, Branchid = ViewBag.BranchId, ledgerName = item.LedgerName, from = ViewBag.From, To = ViewBag.To }, new { target = "_blank" })
                                        </td>
                                        @if (item.DRCR == "DR")
                                        {
                                            topeningdr += item.Opening;

                                            <td align="right">
                                                @item.Opening
                                            </td>
                                            <td align="right">
                                                0
                                            </td>
                                        }
                                        else
                                        {
                                            topeningcr += item.Opening;
                                            <td align="right">
                                                0
                                            </td>
                                            <td align="right">
                                                @item.Opening
                                            </td>
                                        }

                                        <td align="right">
                                            @item.Debit
                                        </td>
                                        <td align="right">
                                            @item.Credit
                                        </td>



                                        @if (item.ClosingDRCR == "DR")
                                        {
                                            tclosingdr += item.Closing;

                                            <td align="right">
                                                @item.Closing
                                            </td>
                                            <td align="right">
                                                0
                                            </td>
                                        }
                                        else
                                        {
                                            tclosingcr += item.Closing;
                                            <td align="right">
                                                0
                                            </td>
                                            <td align="right">
                                                @item.Closing
                                            </td>
                                        }


                                    </tr>

                                }

                                <tr>
                                    <td colspan="2">  Total</td>
                                    <td align="right">
                                        @topeningdr
                                    </td>
                                    <td align="right">
                                        @topeningcr
                                    </td>
                                    <td align="right">
                                        @tdebit
                                    </td>
                                    <td align="right">
                                        @tcredit
                                    </td>
                                    <td align="right">
                                        @tclosingdr
                                    </td>
                                    <td align="right">
                                        @tclosingcr
                                    </td>


                                </tr>


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </aside>


    }

</div>
<br />
