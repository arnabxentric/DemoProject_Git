@model XenERP.Models.SalesInvoiceModelView

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var role = Convert.ToInt32(Session["RoleId"]);
}


<link href="~/css/datetimepicker/datepicker.css" rel="stylesheet" />
<link href="~/Content/select2/select2.min.css" rel="stylesheet" />
<link href="../../Content/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="~/Scripts/JqueryValidation.js"></script>
<script src="../../js/plugins/datetimepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="../../js/jquery-ui-1.10.3.js" type="text/javascript"></script>
<script src="../../Scripts/SalesInvoice.js" type="text/javascript"></script>
<script src="~/Content/select2/select2.full.min.js"></script>

<style>
    .my-table-header {
        background: #55b4b4;
        color: #0e0505;
    }

    .HandCursor {
        cursor: pointer;
    }

    .display-non-div {
        display: none !important;
    }

    .add-component-deletebotton {
        background: url(../Images/icon-delete.png) no-repeat scroll 0 0 rgba(0, 0, 0, 0);
        border: medium none;
        height: 15px;
        width: 15px;
    }

    .select2 {
        width: 100% !important;
    }
</style>

<style>
    .example-modal .modal {
        position: relative;
        top: auto;
        bottom: auto;
        right: auto;
        left: auto;
        display: block;
        z-index: 1;
        color: red;
    }

    .modal {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1040;
        display: none;
        overflow: auto;
        overflow-y: scroll;
        color: red;
    }

    .modal-content {
        background-color: #ffffff;
        width: 330px;
        margin: 130px auto 0 auto;
        text-align: center;
    }

    .example-modal .modal {
        background: transparent !important;
    }
</style>



@*===========SELECT2 ASSAIGN==============*@

<script type="text/javascript">
    $(document).ready(function () {
        $("#dp3").datepicker({
            autoclose: true,
            todayHighlight: true,

        });
        $(".select2").select2();
        var today = new Date();


        //if (role != 1) {

        //    var afterTwoDays = new Date();
        //    afterTwoDays.setDate(today.getDate() - 60);
        //    $("#dp3").datepicker({
        //        autoclose: true,
        //        todayHighlight: true,
        //        startDate: afterTwoDays
        //    });
        //}

        //else if (branchid == 15)
        //{
        //    var afterTwoDays = new Date();
        //    afterTwoDays.setDate(today.getDate() - 60);
        //    $("#dp3").datepicker({
        //        autoclose: true,
        //        todayHighlight: true,
        //        startDate: afterTwoDays
        //    });
        //}
        //else {
        //    $("#dp3").datepicker({
        //        autoclose: true,
        //        todayHighlight: true,

        //    });
        //}
    });
</script>

<script type="text/javascript">

    //$(document).ready(function () {
    //    $("#ProductId").on('change', function () {
    //        var productID = $(this).val();
    //        var x = 0;
    //        console.log(productID);
    //        $('.proId').not(this).each(function () {

    //            if (productID == this.value) {
    //                $("#myModal").modal('show');
    //                $('.msg1').html('You are already issue this type of Product.');
    //                x = 1;
    //            }
    //        });
    //        if (x == 1) {
    //            $(this).val("");
    //            console.log(productID);
    //        }

    //    });
    //});

</script>



<script>
    $(document).ready(function () {
        $("form").on("submit", function (event) {
            var rows = $('#issueDetailsTab tr').length;

            if (rows == 1) {
                $("#myModal").modal('show');
                $('.msg1').html('Please order items to customer');
                return false;
            }

            //$("#loading").fadeIn();
        });

        $('.qnty').on('keyup', function (event) {
            var comptd = $(this).closest('td');
            var comptr = comptd.closest('tr');
            var quantity = $(this).val();
            if (quantity == '') {
                quantity = 0;
            }

            var rate = comptr.find('.rate').val();
            if (rate == '') {
                rate = 0;
            }

            var free = comptr.find('.free').val();
            if (free == '') {
                free = 0;
            }

            var freeQuantity = (2 * quantity) / 100;
            freeQuantity = parseFloat(freeQuantity).toFixed(2);
            comptr.find('.free').val(freeQuantity);
           
            var total = (parseFloat(rate) * parseFloat(quantity)).toFixed(2);
            comptr.find('.total').val(total);


            var grandTotal = 0;
            $('.total').each(function () {

                grandTotal += parseFloat(this.value) || 0;
            });
           
            var grand = parseFloat(grandTotal).toFixed(2);
            $("#GrandTotal").val(grand);
           
        });


        $('.rate').on('keyup', function (event) {
            var comptd = $(this).closest('td');
            var comptr = comptd.closest('tr');
            var rate = $(this).val();
            if (rate == '') {
                rate = 0;
            }

            var quantity = comptr.find('.qnty').val();
            if (quantity == '') {
                quantity = 0;
            }

            var total = (parseFloat(rate) * parseFloat(quantity)).toFixed(2);
            comptr.find('.total').val(total);


            var grandTotal = 0;
            $('.total').each(function () {

                grandTotal += parseFloat(this.value) || 0;
            });

            var grand = parseFloat(grandTotal).toFixed(2);
            $("#GrandTotal").val(grand);

        });

    });
</script>




@using (Html.BeginForm("CreateSalesInvoice", "SalesResponsive", FormMethod.Post))
{



    <aside class="right-side">

        <section class="content-header" style="text-align:center">
            <h4><b>Sales Invoice</b> </h4>

        </section>


        @if (ViewBag.Message != null)
        {
            <div class="alert alert-success alert-dismissable">
                <i class="fa fa-check"></i>
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                @ViewBag.Message
            </div>
        }

        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger alert-dismissable">
                <i class="fa fa-ban"></i>
                <button class="close" aria-hidden="true" data-dismiss="alert" type="button"></button>
                <b>Error!</b>
                @ViewBag.Error
            </div>
        }


        <div id="loading">
            <div id="loadingcontent">
                <p id="loadingspinner">
                    <img src="~/Images/newLoad.gif" />
                </p>
            </div>
        </div>

        <div class="col-md-12">

            <div class="col-md-6">
                <div class="box box-primary">
                    <div class="box-header">  </div>
                    <div class="box-body">

                        <div class="form-group">
                            <label class="black_txt_010">Invoice Date:<span style="color:Red;">*</span> </label>
                            <div class="input-group date" id="dp3" data-date-end-date="0d" data-date-format="@Session["DateFormatLower"]">
                                @Html.TextBoxFor(model => model.Date, new { @class = "form-control", @readonly = "" })
                                <span class="input-group-addon" style=" width:auto !important">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(model => model.Date)
                        </div>
                        <div class="form-group">
                            <label class="black_txt_010"> Customer Name :<span style="color:Red;">*</span> </label>
                            @Html.DropDownListFor(model => model.CustomerId, new SelectList(ViewBag.customer, "Value", "Text"), "------None-----", new { @class = "form-control select2" })
                            @Html.ValidationMessageFor(model => model.CustomerId)

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="box box-primary">
                    <div class="box-header">  </div>
                    <div class="box-body">

                        <div class="form-group">
                            <label class="black_txt_010">Mode of Payment: </label>
                            @Html.DropDownListFor(model => model.Mode, ViewData["mod"] as SelectList, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.Mode)
                        </div>


                        <div class="form-group">
                            <label class="black_txt_010">Refference Number: </label>
                            @Html.TextBoxFor(model => model.ReferenceNo, new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.ReferenceNo)
                        </div>


                        <input name="" type="submit" id="btnsave" value="Submit" class="btn btn-primary" />
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div class="table-responsive">
                    <table id="issueDetailsTab" class="table jambo_table1 bulk_action table-bordered">
                        <thead>
                            <tr class="my-table-header headings">
                                <td class="my-table-header" style="text-align:center;" width="40%">
                                    <label class="black_txt_010">Item</label>
                                </td>

                                <td class="my-table-header" style="text-align:center;" width="10%">
                                    <label class="black_txt_010"> Quantity</label>
                                </td>
                                <td class="my-table-header" style="text-align:center;" width="10%">
                                    <label class="black_txt_010"> Free</label>
                                </td>

                                <td class="my-table-header" style="text-align:center;" width="20%">
                                    <label class="black_txt_010">Rate</label>
                                </td>
                                <td class="my-table-header" style="text-align:center;" width="20%">
                                    <label class="black_txt_010">Total</label>
                                </td>
                            </tr>
                        </thead>

                        @for (int i = 0; i < Model.salesInvoiceItemDetails.Count(); i++)
                        {
                            <tr>
                                <td>@Html.DisplayFor(m => m.salesInvoiceItemDetails[i].ItemName) @Html.HiddenFor(m => m.salesInvoiceItemDetails[i].ItemId)</td>
                                <td align="right">@Html.TextBoxFor(m => m.salesInvoiceItemDetails[i].Quantity, new { @class = "qnty" })</td>
                                <td>@Html.TextBoxFor(m => m.salesInvoiceItemDetails[i].FreeQuantity, new {@class="free" })</td>
                                <td>@Html.TextBoxFor(m => m.salesInvoiceItemDetails[i].Rate, new { @class = "rate" })</td>
                                <td>@Html.TextBoxFor(m => m.salesInvoiceItemDetails[i].TotalPrice, new { @class = "total", @readonly = "readonly" })</td>
                            </tr>


                        }

                        <tr>
                            <td align="right" colspan="4">  <b> Grand Total:</b></td>
                            <td class="right-input"><b class="right-input"> @Html.TextBoxFor(model => model.GrandTotal, new { @class = "grandtotal", @readonly = "readonly", @tabindex = "-1" })</b> </td>

                        </tr>

                    </table>
                </div>

            </div>
        </div>

        <div class="modal fade ignore" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
            <div class="example-modal ">
                <div class="modal-warning">
                    <div class="">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">ALERT !!!</h4>
                            </div>
                            <div class="modal-body">
                                <h4 class="msg1"></h4>
                                <input type="hidden" id="StoreId" value="" />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline" data-dismiss="modal">Close</button>

                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
            </div>

        </div>
    </aside>
}

