@model XenERP.Models.Stock

@{
    Layout = "~/Views/Shared/_Layout.cshtml";   
}
<link href="../../css/AdminLTE.css" rel="stylesheet" type="text/css" />
<link href="../../css/Designer.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="../../css/datetimepicker/datepicker.css" />
<script src="../../Scripts/custom.js" type="text/javascript"></script>
<script src="../../js/plugins/datetimepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="../../js/jquery-ui-1.10.3.js" type="text/javascript"></script>
<link href="../../Content/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<title>WareHouse Transfer</title>

<script language="javascript">

    $(document).ready(function () {

        $("#dp4").datepicker({ autoclose: true, todayHighlight: true });



    });

</script>
<script type="text/javascript">


    $(document).ready(function () {

        $.post("/Warehouse/GetWarehouse", { type: $("#WarehouseId").val() }, function (data) {

            var select = $("#WarehouseTo");
            select.empty();
            select.append($('<option/>', {
                value: "",
                text: "--Select--"
            }));

            $.each(data, function (index, itemData) {
                select.append($('<option/>', {
                    value: itemData.Id2,
                    text: itemData.Name
                }));
            });
        });




        $("#WarehouseId").change(function () {

            $(".Product").val('');
            $(".Quantity").val('');
            $(".Price").val('');

            $(".Totalvalue").val('');


            $.post("/Warehouse/GetWarehouse", { type: $("#WarehouseId").val() }, function (data) {

                var select = $("#WarehouseTo");
                select.empty();
                select.append($('<option/>', {
                    value: "",
                    text: "--Select--"
                }));

                $.each(data, function (index, itemData) {
                    select.append($('<option/>', {
                        value: itemData.Id2,
                        text: itemData.Name
                    }));
                });
            });



        });



    });

</script>
<script type="text/javascript">

    $(document).ready(function () {




        $("#dataTable").on("keypress", '.Quantity', function (event) {




            if (event.which == 8 || event.which == 37 || event.which == 38 || event.which == 39 || event.which == 0) {
                return true;
            }

          
            if (($(this).val().indexOf('.') != -1)) {

                event.preventDefault();
            }

        });



        $(".txttotalvalue").attr("disabled", "disabled");

        $("#dataTable .productid").hide();

        $("#dataTable").on("keypress", '.Product', function (event) {

            $(".Product").attr("maxlength", "50");

        });

        $("#dataTable").on("keypress", '.Quantity', function (event) {


            $(".Quantity").attr("maxlength", "10");


        });



        $("#dataTable").on("keypress", '.Quantity', function (event) {



            if (event.which == 8 || event.which == 37 || event.which == 38 || event.which == 39 || event.which == 0) {
                return true;
            }

            if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57) && event.which != 8) {

                event.preventDefault();
                return false;

            }
            if (($(this).val().indexOf('.') != -1) && ($(this).val().substring($(this).val().indexOf('.'), $(this).val().indexOf('.').length).length > 2)) {

                event.preventDefault();
            }

        });


        $("#dataTable").on("keypress", '.Availability', function (event) {



            if (event.which == 8 || event.which == 37 || event.which == 38 || event.which == 39 || event.which == 0) {
                return true;
            }

            if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57) && event.which != 8) {

                event.preventDefault();
                return false;

            }
            if (($(this).val().indexOf('.') != -1) && ($(this).val().substring($(this).val().indexOf('.'), $(this).val().indexOf('.').length).length > 2)) {

                event.preventDefault();
            }

        });

    });
           
       
</script>
<script language="javascript" type="text/javascript">

    var rowadd = 0;


    $(document).on('click', '.add-component-deletebotton', function () {

        var id = $(this).closest('td').parent()[0].sectionRowIndex;

        document.getElementById("dataTable").deleteRow(id);


    });




    function addRow(tableID) {

        rowadd++;

        var table = document.getElementById(tableID);

        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount);

        var cell1 = row.insertCell(0);
        var element2 = document.createElement("input");
        element2.type = "text";
        element2.name = "txtproduct";
        element2.id = "Product" + rowadd;
        element2.className = "Product";
        cell1.appendChild(element2);





        var cell2 = row.insertCell(1);
        var element3 = document.createElement("select");
        element3.name = "Adjust";
        var option1 = document.createElement("option");
        option1.innerHTML = "INCREASE";
        option1.value = "INCREASE";
        element3.add(option1, null);
        var option2 = document.createElement("option");
        option2.innerHTML = "DECREASE";
        option2.value = "DECREASE";
        element3.add(option2, null);
        cell2.appendChild(element3);




        var cell3 = row.insertCell(2);
        var element4 = document.createElement("input");
        element4.type = "text";
        element4.name = "txtquantity";
        element4.className = "Quantity";
        element4.id = "Quantity" + rowadd;
        cell3.appendChild(element4);






        var cell4 = row.insertCell(3);
        var element5 = document.createElement("input");
        element5.type = "text";
        element5.name = "txtprice";
        element5.className = "Price";
        element5.disabled = "true";
        element5.id = "Unitprice";
        cell4.appendChild(element5);




        var cell5 = row.insertCell(4);
        var element6 = document.createElement("input");
        element6.type = "text";
        element6.name = "txttotalvalue";
       // element6.disabled = "true";
        element6.className = "Totalvalue";
        element6.id = "Totalvalue";
        cell5.appendChild(element6);



        var cell1 = row.insertCell(5);
        var element1 = document.createElement("input");
        element1.type = "button";
        element1.id = "btndelete";
        element1.name = "button[]";
        element1.title = "Delete this row";
        element1.className = "add-component-deletebotton";
        cell1.appendChild(element1);



        var cell6 = row.insertCell(6);
        var element5 = document.createElement("input");
        element5.type = "hidden";
        element5.name = "txtproductid";
        element5.id = "ProductId";
        element5.className = "productid";
        element5.id = "productid" + rowadd;
        cell6.appendChild(element5);
        cell6.className = "display-non-div";

    }

</script>
<script language="javascript" type="text/javascript">

    $(document).ready(function () {




        $("#dataTable").on("keypress", '.Product', function (event) {


            var id = $(this).attr('id');


            $("#" + id).autocomplete({

                source: function (request, response) {
                    $.ajax({
                        url: '/Warehouse/getProduct',
                        data: {

                            query: request.term


                        },


                        dataType: 'json',
                        type: 'POST',

                        success: function (data) {



                            response($.map(data, function (item) {



                                return {


                                    label: item.Name,
                                    value: item.Id



                                }
                            }));

                        }
                    })
                },

                change: function (event, ui) {

                    if (ui.item == null || ui.item == undefined) {


                        $('#' + id).val('');
                        alert("Item not found");
                                            

                        var coltd = $("#" + id).closest('td');
                        var coltr = coltd.closest('tr');
                        coltr.find('.Quantity').val('');
                        coltr.find('.Price').val('');
                        coltr.find('.Totalvalue').val('');

                    




                    }

                },
                select: function (event, ui) {


                    $.get('/Warehouse/getSelectedProductPrice', { 'id': ui.item.value }, function (data) {


                        if (ui.item.value == '') {



                            $("#" + id).val('');
                           

                        }

                        else {



                            $("#" + id).val(ui.item.value);
                            $("#" + id).val(ui.item.label);


                            var ctd = $("#" + id).closest('td'); //.attr('id');
                            var ctr = ctd.closest('tr');
                            var up = ctr.find('.Quantity').val("1");
                            ctr.find('.Price').val(data);
                            ctr.find('.Totalvalue').val(data);
                            ctr.find('.productid').val(ui.item.value);


                        }

                    });
                    return false;
                },
                minLength: 1
            });


        });

    });
</script>
<script language="javascript">

    var rowadd = 0;

    $(document).ready(function () {




        rowadd++;
        var table = document.getElementById('dataTable');
        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount);
        var cell1 = row.insertCell(0);
        var element2 = document.createElement("input");
        element2.type = "text";
        element2.name = "txtproduct";
        element2.id = "Product" + rowadd;
        element2.className = "Product";
        cell1.appendChild(element2);





        var cell2 = row.insertCell(1);
        var element3 = document.createElement("select");
        element3.name = "Adjust";
        var option1 = document.createElement("option");
        option1.innerHTML = "INCREASE";
        option1.value = "INCREASE";
        element3.add(option1, null);
        var option2 = document.createElement("option");
        option2.innerHTML = "DECREASE";
        option2.value = "DECREASE";
        element3.add(option2, null);
        cell2.appendChild(element3);




        var cell3 = row.insertCell(2);
        var element4 = document.createElement("input");
        element4.type = "text";
        element4.name = "txtquantity";
        element4.className = "Quantity";
        element4.id = "Quantity" + rowadd;
        cell3.appendChild(element4);






        var cell4 = row.insertCell(3);
        var element5 = document.createElement("input");
        element5.type = "text";
        element5.name = "txtprice";
        element5.className = "Price";
        element5.disabled = "true";
        element5.id = "Unitprice";
        cell4.appendChild(element5);




        var cell5 = row.insertCell(4);
        var element6 = document.createElement("input");
        element6.type = "text";
        element6.name = "txttotalvalue";
        element6.className = "Totalvalue";
        element6.id = "Totalvalue";
      // element6.disabled = "true";
        cell5.appendChild(element6);


        var cell1 = row.insertCell(5);
        var element1 = document.createElement("input");
        element1.type = "button";
        element1.id = "btndelete";
        element1.name = "button[]";
        element1.title = "Delete this row";
        element1.className = "add-component-deletebotton";
        cell1.appendChild(element1);



        var cell6 = row.insertCell(6);
        var element5 = document.createElement("input");
        element5.type = "hidden";
        element5.name = "txtproductid";
        element5.id = "ProductId";
        element5.className = "productid";
        element5.id = "productid" + rowadd;
        cell6.appendChild(element5);
        cell6.className = "display-non-div";


        $("#btnsubmit").on("click", function () {

            var test = true;

            if ($("#TranDate").val() == "") {
                test = false;
                alert("Please Select Date");
                return false;
            }

            if ($("#Comments").val() == "") {
                test = false;
                alert("Please Enter Reason");
                return false;
            }



            $(".Product ").each(function (i) {
                if ($(this).val() == "") {
                    test = false;
                    alert("Item cannot be left blank");
                    return false;

                }

            });




            if (test == false) {

                return false;

            }


        });



    });
</script>
<script language="javascript">


    $(document).ready(function () {

        $("#dataTable").on("change", '.Quantity', function (event) {


            var ctr = $(this).attr('id');


            var unit = $("#" + ctr).val();


            var ctd = $('#' + ctr).closest('td'); //.attr('id');

            var ctr = ctd.closest('tr');

            var price = ctr.find('.Price').val();



            var Total = parseFloat(unit) * parseFloat(price);


            ctr.find('.Totalvalue ').val(Total);




        });
    });
</script>


@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)

       
        
    <aside class="right-side">
          <section  class="content-header">
                    <h1>
                       Item Adjustment <small>Entry</small>                    
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li><a href="#">Forms</a></li>
                        <li class="active">General Elements</li>
                    </ol>
                </section>



                      <div class="nav-tabs-custom">
                                <ul class="nav nav-tabs">
                                   
                                    <li class="pull-right"><input type="submit" id="btnsubmit" class="btn btn-primary" value="Save" />
                                    
                                    </li>
                                </ul>
                         
                                         </div>

    
                <section class="content">


                 
           
           
                     
        @if (ViewBag.Message != null)
        {
            <div class="alert alert-success alert-dismissable">
                                        <i class="fa fa-check"></i>
                                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                                     @ViewBag.Message
                                    </div>
        }
      @if (ViewBag.Error != null)
      { 
        <div class="alert alert-danger alert-dismissable">
<i class="fa fa-ban"></i>
<button class="close" aria-hidden="true" data-dismiss="alert" type="button">×</button>
<b>Error!</b>
@ViewBag.Error </div>
      }




                    <div class="row">
         
                                  
                <!-- Main content -->
                        <!-- left column -->
                        <div class="col-md-6">
                            <!-- general form elements -->
                            <div class="box box-primary">
                                   <div class="box-header">
                
                                       </div>
                                <!-- form start -->
                    
                
                                           
                           
                                   <div class="box-body">
                                       
                                  
                                        <div class="form-group">
                                          <label class="black_txt_010">
                       WareHouse:<span style="color:Red;">*</span></label>
                       @Html.DropDownListFor(model => model.WarehouseId, new SelectList(ViewBag.FromWarehouse, "Id", "Name"), new { @class = "form-control" })


                                        </div>







                                                    <div class="form-group">
                                          <label class="black_txt_010">
                                   Date:<span style="color:Red;">*</span></label>
                          

                                                            <div class="input-group date" id="dp4" data-date-format="@Session["DateFormatLower"]">@Html.TextBoxFor(model => model.TranDate, new { @class = "form-control" })  <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span> </div>

                                         </div>


                 <div class="form-group">
                                          <label class="black_txt_010">
                 Reason:<span style="color:Red;">*</span></label>
                 
                 @Html.TextAreaFor(model => model.Comments, new { @class = "form-control" })
                 
                                      
                                         </div>

                                         
                                         

                                                    



                                   
                                     </div>
                                     </div>
                                
                                    

                         
                    </div>  
                     <div class="clr"></div>
                 <div class="col-md-12">
                 <div class="box-body">
                                       
                                        <div class="form-group">
                                        <h2>
                                  Item Details</h2>
                            
                                            
                                        </div>
                                        <div class="form-group" style="overflow:hidden;">
                                           <table class="my-table-style" id="dataTable" width="70%" border="0">
                                    <tr class="my-table-header">
                                        <td class="my-table-header" style="text-align:center;">
                                            <label class="black_txt_010">
                      Item</label>
                                        </td>
                        <td  style="text-align:center;">
                                             <label class="black_txt_010">
                     Adjustment</label>
                                        </td>



                                          <td  style="text-align:center;">
                                             <label class="black_txt_010">
                     Quantity</label>
                                        </td>


                                        
                                          <td  style="text-align:center;">
                                             <label class="black_txt_010">
                     Unit Price</label>
                                        </td>


                                         
                                          <td  style="text-align:center;">
                                             <label class="black_txt_010">
                     Total Value</label>
                                        </td>

                                        <td></td>
                                    </tr>
                                </table>
                                <input type="button" class="add-component-botton" onclick="addRow('dataTable')" />
                             
                      
                                        </div>
                                     </div>

                 </div>
                

              </section>
        
        
        </aside>
        
        
        
        
}
