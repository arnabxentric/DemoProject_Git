@model IEnumerable<XenERP.Models.ModelView.FeedStockModelView>

using XenERP.Models
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    long roleId = Convert.ToInt64(Session["RoleId"]);
}
@{

    int Slno = 0;
}
<link href="../../css/AdminLTE.css" rel="stylesheet" type="text/css" />
<link href="../../css/Designer.css" rel="stylesheet" type="text/css" />
<link href="~/css/datetimepicker/datepicker.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/JqueryValidation.js"></script>
<script src="../../js/plugins/datetimepicker/bootstrap-datepicker.js" type="text/javascript"></script>
<script src="../../js/jquery-ui-1.10.3.js" type="text/javascript"></script>
<link href="~/Content/select2/select2.min.css" rel="stylesheet" />
<script src="~/Content/select2/select2.full.min.js"></script>
<style type="text/css">
    table.dataTable thead .sorting_desc {
        background: url("/Images/sort_desc.png") no-repeat scroll right center #53A9BC;
    }

    table.dataTable thead .sorting_asc {
        background: url("/Images/sort_asc.png") no-repeat scroll right center #53A9BC;
    }

    .modal-content {
        background-color: #b2b266;
        /*width: 600px;*/
        margin: 130px auto 0 auto;
        text-align: center;
    }
</style>
<script type="text/javascript">

    $(function () {
        //$('#example1').dataTable({
        //    "bPaginate": true,
        //    "bLengthChange": true,
        //    "bFilter": true,
        //    "bSort": false,
        //    "bInfo": true,
        //    "bAutoWidth": true
        //});
    });
</script>
<script>
    $(document).ready(function () {

        $("#dp3").datepicker({ autoclose: true, todayHighlight: true });
        $("#dp4").datepicker({ autoclose: true, todayHighlight: true });
        $("#example1").on('click', '.edit', function () {
            var comptd = $(this).closest('td');
            var comptr = comptd.closest('tr');
            var id = comptr.find('.id').val();
            window.location.href = "/HariDailyEntry/UpdateGcDespatch?Id=" + id;

        });
        $("#example1").on('click', '.pluspng', function () {
            var ctd = $(this).closest('td');
            var ctr = ctd.parent('tr');
            ctr.find(".pluspng").css("display", "none");
            ctr.find(".minuspng").css("display", "inline");
            var nextTr = ctr.next('tr');
            //  nextTr.css("display", "block");
            nextTr.find(".detailDiv").css("display", "block");

        });
        $("#example1").on('click', '.minuspng', function () {
            var ctd = $(this).closest('td');
            var ctr = ctd.parent('tr');
            ctr.find(".pluspng").css("display", "inline");
            ctr.find(".minuspng").css("display", "none");
            var nextTr = ctr.next('tr');
            //   nextTr.css("display", "none");
            nextTr.find(".detailDiv").css("display", "none");

        });

        $("#btnSubmit").on('click', function () {
            var id = $("#GcId").val();
            var date = $("#LotReceivedate").val();
            window.location.href = "/HariDailyEntry/UpdateReceiveDate?Id=" + id + "&&Date=" + date;
        });

        $("#example1").on('click', '.rec', function () {
            var comptd = $(this).closest('td');
            var comptr = comptd.closest('tr');
            var id = comptr.find('.id').val();
          
            $("#GcId").val(id);
            $("#myModalReceive").modal('show');
        });

        $("#example1").on('click', '.pay', function () {
            var comptd = $(this).closest('td');
            var comptr = comptd.closest('tr');
            var id = comptr.find('.id').val();

            $("#GcIdPay").val(id);
            $("#myModalPayment").modal('show');
        });

        $("#btnSubmit1").on('click', function () {
            var id = $("#GcIdPay").val();
            var date = $("#LotPaymentDate").val();
            window.location.href = "/HariDailyEntry/UpdatePaymentDate?Id=" + id + "&&Date=" + date;
        });

    });
</script>
<aside class="right-side">
    <section class="content-header">
        <h1>Lot Tracking <small>List</small> </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="#">Forms</a></li>
            <li class="active">General Elements</li>
        </ol>
    </section>



    @if (ViewBag.Message != null)
    {
        <div class="alert alert-success alert-dismissable">
            <i class="fa fa-check"></i>
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            @ViewBag.Message
        </div>
    }

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger alert-dismissable">
            <i class="fa fa-ban"></i>
            <button class="close" aria-hidden="true" data-dismiss="alert" type="button">×</button>
            <b>Error!</b>
            @ViewBag.Error
        </div>
    }



    <div class="box">

        <div class="box-body table-responsive">
            @if (roleId == 4)
            {
                <div class="col-xs-12" style="text-align:center">
                    <a href="@Url.Action("GcReadyForDespatch", "HariDailyEntry")" class="btn btn-danger"> <i class="fa fa-fw fa-plus-square"></i>New Lot Tracking</a>
                </div>
            }

            <table id="example1" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>SlNo.</th>
                        <th>Branch Name</th>
                        <th>HO Sent Date</th>
                        <th>HO Receive Date</th>
                        <th>Total GC Amount</th>
                        <th>Total Book</th>
                        <th>Payment Date</th>
                        @if (roleId == 1)
                        {
                            <th></th>
                            <th></th>
                            <th></th>
                        }

                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {

                        Slno = Slno + 1;
                        <tr>
                            <td>@Slno</td>
                            <td>
                                <img class="pluspng" src="~/Images/pluspng.png" />
                                <img class="minuspng" src="~/Images/minuspng.png" style="display:none" />
                                @item.BranchName  @Html.HiddenFor(m => item.NeftId, new { @class = "id" })
                            </td>
                            <td> @Html.DisplayFor(modelItem => item.HoSentDate)</td>
                            <td> @Html.DisplayFor(modelItem => item.LotReceivedate)</td>
                            <td> @Html.DisplayFor(modelItem => item.TotalGCAmount)</td>
                            <td> @Html.DisplayFor(modelItem => item.TotalBook)</td>
                            <td> @Html.DisplayFor(modelItem => item.LotPaymentDate)</td>

                            @if (roleId == 1)
                            {
                                <td style="text-align:center"><button class="btn btn-primary btn-sm edit ">Update</button></td>
                                <td style="text-align:center"><button class="btn btn-primary btn-sm rec ">Update Receive</button></td>
                                <td style="text-align:center"><button class="btn btn-primary btn-sm pay ">Update Payment</button></td>
                            }


                        </tr>



                        var SlNo1 = 0;
                        <tr>
                            <td colspan="8" style="padding:0px 0px 0px 0px;">
                                <div id="demo_@Slno" class="detailDiv" style="display:none">
                                    <table border="1" width="100%">
                                        <tr>
                                            <th style="text-align:center">SlNo.</th>

                                            <th style="text-align:center">
                                                Farmer Name
                                            </th>

                                            <th style="text-align:center">
                                                Flock Code
                                            </th>

                                            <th style="text-align:center">
                                                Lot No
                                            </th>
                                            <th style="text-align:center">
                                                Placement Date
                                            </th>

                                            <th style="text-align:center">
                                                End Date
                                            </th>
                                            <th style="text-align:center">
                                                Difference
                                            </th>
                                            <th style="text-align:center">
                                                GC Amount
                                            </th>
                                            <th style="text-align:center">
                                                Linesmen Name
                                            </th>

                                        </tr>
                                        @foreach (var item1 in item.neftList)
                                        {
                                            SlNo1++;
                                        <tr>
                                            <td> @SlNo1</td>

                                            <td>@item1.FarmerName</td>
                                            <td>@item1.FlockCode</td>
                                            <td>@item1.LotNo</td>
                                            <td>@item1.PlacementDate</td>
                                            <td>@item1.EndDate</td>
                                            <td style="text-align:center">@item1.DiffRange</td>
                                            <td>@item1.GCAmount</td>
                                            <td>@item1.LinesmanName</td>
                                        </tr>


                                        }
                                    </table>
                                </div>
                            </td>
                        </tr>


                    }
                </tbody>
            </table>
        </div><!-- /.box-body -->
    </div>
</aside>


<div class="modal fade ignore" id="myModalReceive" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: darkcyan">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" style="color:white"><b>Update Receive Date</b> </h4>
            </div>
            <div class="modal-body">

                <div class="box-body">
                    <div class="row">
                        <div class="form-group">
                            <label class=""> HO Receive Date:<span style="color:Red;">*</span> </label>
                            <div class="input-group date" id="dp3" data-date-format="@Session["DateFormatLower"]">@Html.TextBoxFor(model => model.FirstOrDefault().LotReceivedate, new { @class = "form-control", @readonly = "" })  <span class="input-group-addon" style=" width:auto !important"><i class="glyphicon glyphicon-calendar"></i></span> </div>
                     
                            <input type="hidden" id="GcId" />
                        </div>

                    </div>
                    <input type="button" id="btnSubmit" value="Submit" class="btn btn-primary" />
                </div>

            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>


<div class="modal fade ignore" id="myModalPayment" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: darkcyan">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" style="color:white"><b>Update Payment Date</b> </h4>
            </div>
            <div class="modal-body">

                <div class="box-body">
                    <div class="row">
                        <div class="form-group">
                            <label class=""> HO Payment Date:<span style="color:Red;">*</span> </label>
                            <div class="input-group date" id="dp4" data-date-format="@Session["DateFormatLower"]">@Html.TextBoxFor(model => model.FirstOrDefault().LotPaymentDate, new { @class = "form-control", @readonly = "" })  <span class="input-group-addon" style=" width:auto !important"><i class="glyphicon glyphicon-calendar"></i></span> </div>

                            <input type="hidden" id="GcIdPay" />
                        </div>

                    </div>
                    <input type="button" id="btnSubmit1" value="Submit" class="btn btn-primary" />
                </div>

            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
